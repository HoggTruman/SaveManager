<Window x:Class="SaveManager.Views.Save.SaveWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SaveManager.Views.Save"
        xmlns:models="clr-namespace:SaveManager.Models"
        xmlns:viewmodels="clr-namespace:SaveManager.ViewModels"
        d:DataContext="{d:DesignInstance Type=viewmodels:SaveViewModel}"
        mc:Ignorable="d"
        Title="Save Manager"
        MinHeight="500"
        MinWidth="570"
        Background="GhostWhite"
        WindowStartupLocation="CenterScreen"
        MouseDown="Window_MouseDown"
        Closing="Window_Closing">
    <Window.Resources>
        <!--<Style TargetType="{x:Type MenuItem}">
            <Style.Triggers>
                <Trigger Property="IsEnabled"
                         Value="False">
                    <Setter Property="Background"
                            Value="Red" />
                </Trigger>
            </Style.Triggers>
        </Style>-->

        <SolidColorBrush x:Key="LoadBrush"
                         Color="#2eb9ff" />

        <SolidColorBrush x:Key="ReplaceBrush"
                         Color="#ff9500" />

        <SolidColorBrush x:Key="RefreshBrush"
                         Color="#a538ff" />


        <Style x:Key="FadeWhenDisabled"
               TargetType="Image">
            <Style.Triggers>
                <Trigger Property="IsEnabled"
                         Value="False">
                    <Setter Property="Opacity"
                            Value="0.35" />
                </Trigger>
            </Style.Triggers>
        </Style>


        <Style x:Key="Notification"
               TargetType="Border">
            <Setter Property="Visibility"
                    Value="Hidden" />
            <Setter Property="IsHitTestVisible"
                    Value="False" />
            <Setter Property="BorderThickness"
                    Value="3" />
            <Setter Property="Grid.Row"
                    Value="1" />
            <Setter Property="HorizontalAlignment"
                    Value="Center" />
            <Setter Property="VerticalAlignment"
                    Value="Bottom" />
            <Setter Property="Margin"
                    Value="0,0,0,20" />
            <Style.Triggers>
                <Trigger Property="Visibility"
                         Value="Visible">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard AutoReverse="True">
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 From="0.0"
                                                 To="2.5"
                                                 Duration="0:0:1" />
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                </Trigger>
            </Style.Triggers>
        </Style>


        <PopupAnimation x:Key="{x:Static SystemParameters.MenuPopupAnimationKey}">None</PopupAnimation>

        <DrawingBrush x:Key="DraggedOverBorderBrush"
                      Viewport="0,0,8,8"
                      ViewportUnits="Absolute"
                      TileMode="Tile">
            <DrawingBrush.Drawing>
                <DrawingGroup>
                    <GeometryDrawing Brush="Black">
                        <GeometryDrawing.Geometry>
                            <GeometryGroup>
                                <RectangleGeometry Rect="0,0,50,50" />
                                <RectangleGeometry Rect="50,50,50,50" />
                            </GeometryGroup>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                </DrawingGroup>
            </DrawingBrush.Drawing>
        </DrawingBrush>

    </Window.Resources>


    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>


        <Grid Height="Auto"
              VerticalAlignment="Top">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="100" />
            </Grid.ColumnDefinitions>

            <Label Target="{Binding ElementName=GameComboBox}"
                   Content="Game:"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Center"
                   FontSize="14"
                   Margin="10,2,0,0"
                   Padding="0" />

            <ComboBox x:Name="GameComboBox"
                      ItemsSource="{Binding Games}"
                      SelectedItem="{Binding ActiveGame}"
                      DisplayMemberPath="Name"
                      HorizontalAlignment="Stretch"
                      Grid.Row="1"
                      Height="24"
                      Margin="10,5" />

            <Button x:Name="GameEditButton"
                    Click="GameEditButton_Click"
                    Content="Edit"
                    HorizontalAlignment="Center"
                    Grid.Row="1"
                    Grid.Column="1"
                    Width="80"
                    Height="24"
                    Margin="10,0,10,0" />

            <Label Target="{Binding ElementName=ProfileComboBox}"
                   Content="Profile:"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Center"
                   Grid.Row="2"
                   FontSize="14"
                   Margin="10,2,0,0"
                   Padding="0" />

            <ComboBox x:Name="ProfileComboBox"
                      ItemsSource="{Binding ActiveGame.Profiles}"
                      SelectedItem="{Binding ActiveGame.ActiveProfile}"
                      DisplayMemberPath="Name"
                      SelectionChanged="ProfileComboBox_SelectionChanged"
                      HorizontalAlignment="Stretch"
                      Grid.Row="3"
                      Height="24"
                      Margin="10,5" />

            <StackPanel Grid.Row="3"
                        Grid.Column="1"
                        Width="80"
                        Margin="10,0"
                        Orientation="Horizontal">
                <Button x:Name="AddProfileButton"
                        Click="AddProfileButton_Click"
                        Width="24"
                        Height="24"
                        Margin="0,0,4,0">
                    <Image Source="/Assets/PlusIcon.png" />
                </Button>

                <Button x:Name="RenameProfileButton"
                        Click="RenameProfileButton_Click"
                        Width="24"
                        Height="24">
                    <Image Source="/Assets/RenameIcon.png" />
                </Button>

                <Button x:Name="RemoveProfileButton"
                        Click="RemoveProfileButton_Click"
                        Width="24"
                        Height="24"
                        Margin="4,0,0,0">
                    <Image Source="/Assets/DeleteIcon.png" />
                </Button>

                
            </StackPanel>



        </Grid>



        <ListBox x:Name="SaveListBox"
                 ItemsSource="{Binding ActiveGame.ActiveProfile.SaveListEntries}"
                 SelectedItem="{Binding SelectedEntry}"
                 MouseDown="SaveListBox_MouseDown"
                 ContextMenuOpening="SaveListBox_ContextMenuOpening"
                 KeyUp="SaveListBox_KeyUp"
                 SelectionChanged="SaveListBox_SelectionChanged"
                 Drop="SaveListBox_Drop"
                 HorizontalContentAlignment="Stretch"
                 VerticalContentAlignment="Stretch"
                 Margin="10 10"
                 Width="Auto"
                 Grid.Row="1"
                 IsTabStop="False"
                 FocusVisualStyle="{x:Null}"
                 AllowDrop="True">
            <ListBox.Resources>
                <Style TargetType="ListBoxItem">
                    <Setter Property="IsTabStop"
                            Value="False" />
                </Style>

                <local:SaveListItemPaddingConverter x:Key="paddingConverter" />

                <DataTemplate DataType="{x:Type models:Folder}">
                    <ItemsControl x:Name="FolderTemplate"
                                  MouseDoubleClick="SaveListItem_MouseDoubleClick"
                                  Height="16"
                                  Padding="{Binding Converter={StaticResource paddingConverter}}"
                                  Background="Transparent"
                                  IsTabStop="False">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="16" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                </Grid>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <Image Height="16"
                               Width="16">
                            <Image.Style>
                                <Style TargetType="{x:Type Image}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsOpen}"
                                                     Value="false">
                                            <Setter Property="Source"
                                                    Value="/Assets/FolderClosed.png" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsOpen}"
                                                     Value="true">
                                            <Setter Property="Source"
                                                    Value="/Assets/FolderOpen.png" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Image.Style>
                        </Image>
                        <TextBlock Text="{Binding Name}"
                                   Grid.Column="1"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"
                                   Height="16"
                                   Padding="5 0 0 0" />
                    </ItemsControl>
                </DataTemplate>

                <DataTemplate DataType="{x:Type models:File}">
                    <TextBlock x:Name="FileTemplate"
                               Text="{Binding Name}"
                               Height="16"
                               VerticalAlignment="Center"
                               Padding="{Binding Converter={StaticResource paddingConverter}}"
                               Background="Transparent" />
                </DataTemplate>
            </ListBox.Resources>

            <ListBox.ItemContainerStyle>
                <Style TargetType="{x:Type ListBoxItem}">
                    <EventSetter Event="PreviewMouseDown"
                                 Handler="SaveListItem_PreviewMouseDown" />
                    <EventSetter Event="MouseMove"
                                 Handler="SaveListItem_MouseMove" />
                    <EventSetter Event="DragEnter"
                                 Handler="SaveListItem_DragEnter" />
                    <EventSetter Event="DragLeave"
                                 Handler="SaveListItem_DragLeave" />
                    <EventSetter Event="Drop"
                                 Handler="SaveListItem_Drop" />
                    <Setter Property="Margin"
                            Value="0" />
                    <Setter Property="IsTabStop"
                            Value="False" />
                </Style>
            </ListBox.ItemContainerStyle>

            <ListBox.ContextMenu>
                <ContextMenu x:Name="SaveListContextMenu">
                    <MenuItem x:Name="AddFolderMenuItem"
                              Header="Add Folder"
                              Click="AddFolderMenuItem_Click">
                        <MenuItem.Icon>
                            <Image Source="/Assets/AddFolderIcon.png"
                                   Margin="-1,-1,-1,-1" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem x:Name="DeleteMenuItem"
                              Header="Delete"
                              InputGestureText="Del"
                              Click="DeleteMenuItem_Click">
                        <MenuItem.Icon>
                            <Image Source="/Assets/DeleteIcon.png"
                                   Margin="-1,-1,-1,-1" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem x:Name="RenameMenuItem"
                              Header="Rename"
                              InputGestureText="F2"
                              Click="RenameMenuItem_Click">
                        <MenuItem.Icon>
                            <Image Source="/Assets/RenameIcon.png"
                                   Margin="0,-1,-2,-1" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem x:Name="RefreshMenuItem"
                              Header="Refresh"
                              Click="RefreshMenuItem_Click">
                        <MenuItem.Icon>
                            <Image Source="/Assets/RefreshIcon.png"
                                   Margin="1,-1,-2,-1" />
                        </MenuItem.Icon>
                    </MenuItem>
                </ContextMenu>
            </ListBox.ContextMenu>
        </ListBox>


        <Border x:Name="LoadedNotification"
                Style="{StaticResource Notification}"
                BorderBrush="{StaticResource LoadBrush}">
            <StackPanel Orientation="Horizontal">
                <Image Source="/Assets/LoadSave.png"
                       Width="30"
                       Margin="10 2" />
                <TextBlock Text="Load Successful"
                           FontSize="24"
                           Foreground="{StaticResource LoadBrush}"
                           Margin="10 2" />
            </StackPanel>
        </Border>


        <Border x:Name="ReplacedNotification"
                Style="{StaticResource Notification}"
                BorderBrush="{StaticResource ReplaceBrush}">
            <StackPanel Orientation="Horizontal">
                <Image Source="/Assets/ReplaceSave.png"
                       Width="30"
                       Margin="10 2" />
                <TextBlock Text="Replace Successful"
                           FontSize="24"
                           Foreground="{StaticResource ReplaceBrush}"
                           Margin="10 2" />
            </StackPanel>
        </Border>


        <Border x:Name="RefreshNotification"
                Style="{StaticResource Notification}"
                BorderBrush="{StaticResource RefreshBrush}">
            <StackPanel Orientation="Horizontal">
                <Image Source="/Assets/RefreshIcon.png"
                       Width="30"
                       Margin="10 2" />
                <TextBlock Text="Profiles Refreshed"
                           FontSize="24"
                           Foreground="{StaticResource RefreshBrush}"
                           Margin="10 2" />
            </StackPanel>
        </Border>


        <Grid Width="Auto"
              Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="50" />
            </Grid.ColumnDefinitions>

            <Button x:Name="ImportSaveButton"
                    Click="ImportSaveButton_Click"
                    IsEnabled="{Binding CanImportSave}"
                    Width="Auto"
                    Height="30"
                    Grid.Column="0"
                    Margin="10">
                <StackPanel Orientation="Horizontal">
                    <Image Source="/Assets/ImportSave.png"
                           Height="20"
                           Width="20"
                           Style="{StaticResource FadeWhenDisabled}" />
                    <TextBlock Text="Import Save"
                               VerticalAlignment="Center"
                               Padding="5 0 2 0" />
                </StackPanel>
            </Button>

            <Button x:Name="LoadSaveButton"
                    Click="LoadSaveButton_Click"
                    IsEnabled="{Binding CanLoadSave}"
                    Width="Auto"
                    Height="30"
                    Grid.Column="1"
                    Margin="10">
                <StackPanel Orientation="Horizontal">
                    <Image Source="/Assets/LoadSave.png"
                           Height="20"
                           Width="20"
                           Style="{StaticResource FadeWhenDisabled}" />
                    <TextBlock Text="Load Selected"
                               VerticalAlignment="Center"
                               Padding="5 0 1 0" />
                </StackPanel>
            </Button>

            <Button x:Name="ReplaceSaveButton"
                    Click="ReplaceSaveButton_Click"
                    IsEnabled="{Binding CanReplaceSave}"
                    Width="Auto"
                    Height="30"
                    Grid.Column="2"
                    Margin="10">
                <StackPanel Orientation="Horizontal">
                    <Image Source="/Assets/ReplaceSave.png"
                           Height="20"
                           Width="20"
                           Style="{StaticResource FadeWhenDisabled}" />
                    <TextBlock Text="Replace Selected"
                               VerticalAlignment="Center"
                               Padding="5 0 0 0" />
                </StackPanel>
            </Button>

            <Button x:Name="SettingsButton"
                    Width="30"
                    Height="30"
                    Grid.Column="3"
                    Margin="10">
                <Image Source="/Assets/Settings.png"
                       Height="24"
                       Width="24" />
            </Button>
        </Grid>
    </Grid>
</Window>
